# 🏋️ 健身房会员管理系统 (GymLite) - v2.0 架构方案

## 1. 核心定义 (MVP Scope)

目标：在轻量级管理的基础上，增加会员服务属性，打造“管理+服务”闭环。

用户：

1.  **管理员 (Admin)**：前台/店长，负责开卡、续费、看数据。
2.  **会员 (Member)**：健身用户，负责查看剩余天数、记录身体变化、记录训练日志。

### 1.1 功能模块

-   **管理端 (Admin Side)**：
    -   **会员管理**：录入（默认密码YYYYMMDD）、修改、封禁/解封、**续费**、**重置密码**。
    -   **入场登记**：输入手机号快速打卡，支持重复入场无需去重；**今日入场列表**实时显示。
    -   **全局看板**：今日到馆人数 (去重)、营收概况、有效会员数。
-   **会员端 (Member Side)**：
    -   **个人中心**：查看有效期、剩余天数、修改头像/密码。
    -   **身体数据**：录入体重/体脂/围度，生成变化曲线图。
    -   **健身日记**：打卡式记录今日训练部位、时长和感受。
    -   **统计概览**：累计/本周到馆天数 (一天多次仅算一次)。

------

## 2. 技术架构与选型 (Architecture & Stack)

### 2.1 架构模式：全栈单体 (Monolithic Full-stack)

选择：Next.js (App Router)

理由：

-   **双端同构**：管理端和会员端共享同一套数据库定义和工具函数。
-   **Server Actions**：直接在组件内调用后端逻辑，配合 Next.js 的缓存机制，极速渲染数据报表。

### 2.2 关键库选型

-   **Framework**: Next.js 14+ (React)
-   **Database**: SQLite (生产环境使用文件挂载，轻量稳定)
-   **ORM**: Prisma (Schema First)
-   **Auth**: Cookie Session / NextAuth.js (实现简单的双端鉴权)
-   **UI Components**: Shadcn/ui + Tailwind CSS
-   **Visualization**: **Recharts** (新增：用于绘制身体数据折线图)
-   **Security**: Bcrypt (密码加密)

------

## 3. 数据库设计 (Schema Design)

 [数据库设计.md](数据库设计.md) 

------

## 4. 代码结构设计 (Project Structure)

引入了**路由分组 (Route Groups)** 来物理隔离管理端和会员端的页面逻辑。

```Plaintext
my-gym-app/
├── prisma/
│   └── schema.prisma       # 更新后的数据库定义
├── src/
│   ├── app/
│   │   ├── (auth)/         # 公共认证
│   │   │   └── login/page.tsx
│   │   │
│   │   ├── (admin)/        # 管理员专属区域 (布局含侧边栏)
│   │   │   ├── admin/dashboard/
│   │   │   └── admin/members/
│   │   │
│   │   ├── (member)/       # 会员专属区域 (布局含底部导航)
│   │   │   ├── member/dashboard/  # 个人概览
│   │   │   ├── member/body/       # 身体数据 (图表页)
│   │   │   └── member/workouts/   # 训练日志
│   │   │
│   │   └── api/            # 极少量的 API
│   │
│   ├── actions/            # Server Actions (业务逻辑核心)
│   │   ├── auth-actions.ts    # 登录/注销/Session检查
│   │   ├── admin-ops.ts       # 管理员操作 (开卡/续费)
│   │   └── member-data.ts     # 会员操作 (录入体重/查图表)
│   │
│   ├── components/
│   │   ├── charts/            # Recharts 封装组件
│   │   │   └── WeightChart.tsx
│   │   └── business/
│   │       ├── MemberForm.tsx
│   │       └── WorkoutCard.tsx
│   │
│   └── lib/
│       ├── db.ts              # Prisma Client
│       └── session.ts         # 简单的 Cookie 加密工具
├── Dockerfile
└── docker-compose.yml
```

------

## 5. 部署方案 (Deployment)

保持不变，依然利用 Docker 容器化部署。

### 5.1 部署文件

-   **Dockerfile**: 采用多阶段构建 (`node:20-alpine`)，集成 `libc6-compat` 和 `openssl` 以支持 Prisma。
-   **docker-compose.yml**: 编排服务，并持久化挂载 SQLite 数据文件。

### 5.2 常用命令

```bash
# 1. 首次部署或重建
docker-compose up -d --build

# 2. 查看日志
docker-compose logs -f

# 3. 停止服务
docker-compose down
```

### 5.3 环境变量

*   `DATABASE_URL`: 容器内默认指向 `file:./dev.db` (挂载至 `/app/prisma/dev.db`)
*   `SESSION_SECRET`: 建议在 `docker-compose.yml` 或 `.env` 中修改。

------

## 6. 开发路线图 (Updated Roadmap)

1.  **基础建设**：
    -   初始化 Next.js 项目。
    -   配置 Tailwind + Shadcn/ui。
    -   **执行 `prisma db push` 生成新数据库结构**。
2.  **核心鉴权 (Auth)**：
    -   编写 `auth-actions.ts`：实现 Login 逻辑，区分 `role: 'admin'` 和 `role: 'member'`。
    -   编写 Middleware：拦截 `/admin` 和 `/member` 路由，确保未登录无法访问。
3.  **管理端开发 (Admin MVP)**：
    -   实现会员列表、开卡（生成默认密码）、续费功能。
    -   实现前台签到功能。
4.  **会员端开发 (Member Service)**：
    -   实现 `MemberDashboard`：展示“您的会员卡还有 X 天到期”。
    -   **数据可视化**：引入 Recharts，开发体重/体脂折线图。
    -   **日志系统**：开发简单的健身打卡表单。
5.  **测试与上线**：
    -   模拟管理员开卡 -> 会员登录 -> 录入数据 -> 管理员查看的全流程。
    -   Docker 打包上线。

